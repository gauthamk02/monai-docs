
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lazy Resampling &#8212; MONAI 1.5.1 Documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=26ac546f" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=cb7e6255"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lazy_resampling';</script>
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="MONAI Bundle Properties" href="mb_properties.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.5.1" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/MONAI-logo-color.png" class="logo__image only-light" alt="MONAI 1.5.1 Documentation - Home"/>
    <img src="_static/MONAI-logo-color.png" class="logo__image only-dark pst-js-only" alt="MONAI 1.5.1 Documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="whatsnew.html">
    What’s New
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="highlights.html">
    Highlights
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="api.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="installation.html">
    Installation Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="precision_accelerating.html">
    Precision and Accelerating
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="contrib.html">
    Development
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="bundle_intro.html">
    Bundle
  </a>
</li>


<li class=" current active">
  <a class="nav-link dropdown-item nav-internal" href="#">
    Lazy Resampling
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://github.com/Project-MONAI/tutorials">
    Tutorials
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/project-monai/monai" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/projectmonai" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-twitter-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="whatsnew.html">
    What’s New
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="highlights.html">
    Highlights
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="api.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="installation.html">
    Installation Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="precision_accelerating.html">
    Precision and Accelerating
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="contrib.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="bundle_intro.html">
    Bundle
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="#">
    Lazy Resampling
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://github.com/Project-MONAI/tutorials">
    Tutorials
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/project-monai/monai" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/projectmonai" title="Twitter" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-twitter-square fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Twitter</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"></div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Lazy Resampling</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="id1">
<h1>Lazy Resampling<a class="headerlink" href="#id1" title="Link to this heading">#</a></h1>
<div class="toctree-wrapper compound">
</div>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>Lazy Resampling is a new feature introduced in MONAI 1.2. This feature is still experimental at this time and it is
possible that behaviour and APIs will change in upcoming releases.</p>
<p>Lazy resampling reworks the way that preprocessing is performed. It improves upon standard preprocessing pipelines and
can provide significant benefits over traditional preprocessing. It can improve:
* pipeline execution time
* pipeline memory usage in CPU or GPU
* image and segmentation quality by reducing incidental noise and artifacts caused by resampling</p>
<p>The way it does this is by adopting the methods used in computer graphics pipelines, in which transformations to objects
in a scene are modified by composing together a sequence of “homogeneous matrices”.</p>
<p>Rather than each transform being executed in isolation, potentially requiring the data to be resampled to make a new
tensor, transforms whose operations can be described in terms of homogeneous transforms do not execute their transforms
immediately. Instead, they create a “pending operation”, which is added to a list of operations that will be fused
together and carried out at the point that they are required.</p>
</section>
<section id="how-lazy-resampling-changes-preprocessing">
<h2>How Lazy Resampling changes preprocessing<a class="headerlink" href="#how-lazy-resampling-changes-preprocessing" title="Link to this heading">#</a></h2>
<p>In order to understand the difference between traditional pipelines and lazy pipelines, it is best to look at an example
pipeline and the differences between their execution strategies:</p>
<section id="traditional-execution">
<h3>Traditional execution<a class="headerlink" href="#traditional-execution" title="Link to this heading">#</a></h3>
<p>With traditional resampling, found both in MONAI and many other preprocessing libraries, you typically define a sequence
of transforms and pass them to a <code class="docutils literal notranslate"><span class="pre">Compose</span></code> object, such as <a class="reference internal" href="transforms.html#monai.transforms.Compose" title="monai.transforms.compose.Compose"><code class="xref py py-class docutils literal notranslate"><span class="pre">monai.transforms.compose.Compose</span></code></a>.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">transforms</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Spacingd</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="s2">&quot;seg&quot;</span><span class="p">],</span> <span class="o">...</span><span class="p">),</span>
    <span class="n">Orientationd</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="s2">&quot;seg&quot;</span><span class="p">],</span> <span class="o">...</span><span class="p">),</span>
    <span class="n">RandSpatialCropd</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="s2">&quot;seg&quot;</span><span class="p">],</span> <span class="o">...</span><span class="p">),</span>
    <span class="n">RandRotate90d</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="s2">&quot;seg&quot;</span><span class="p">],</span> <span class="o">...</span><span class="p">),</span>
    <span class="n">RandRotated</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="s2">&quot;seg&quot;</span><span class="p">],</span> <span class="o">...</span><span class="p">),</span>
    <span class="n">RandZoomd</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="s2">&quot;seg&quot;</span><span class="p">],</span> <span class="o">...</span><span class="p">),</span>
    <span class="n">RandGaussianNoised</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Compose</span><span class="p">(</span><span class="n">transforms</span><span class="p">)</span>

<span class="c1"># elsewhere this will be called many times (such as in a Dataset instance)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</pre></div>
</div>
<p>The following will then happen when we call <code class="docutils literal notranslate"><span class="pre">pipeline(inputs)</span></code>:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Spacingd</span></code> is called and interpolates the data samples</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Orientationd</span></code> permutes the data samples so that their spatial dimensions are reorganised</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RandSpatialCropd</span></code> crops a random patch of the data samples, throwing away the rest of the data in the process</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RandRotate90d</span></code> has a chance of performing a tensor-based rotation of the data samples</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RandRotated</span></code> has a chance of performing a full resample of the data samples</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RandZoomd</span></code> has a chance of performing a interpolation of the data samples</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RandGaussianNoised</span></code> has a chance of adding noise to <code class="docutils literal notranslate"><span class="pre">img</span></code></p></li>
</ol>
<figure class="align-default" id="id2">
<img alt="_images/lazy_resampling_trad_example_1.svg" src="_images/lazy_resampling_trad_example_1.svg" />
<figcaption>
<p><span class="caption-text">Figure showing traditional pipeline execution. Tensors (the boxes in the main body of the image) are passed through
the pipeline, and the state of their <cite>applied_operations</cite> property is shown at each step. Tensors with a thick red
border have undergone some kind of resample operation at that stage.</span><a class="headerlink" href="#id2" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Overall, there are up to three occasions where the data is either interpolated or resampled through spatial transforms
(<code class="docutils literal notranslate"><span class="pre">Spacingd</span></code>, <code class="docutils literal notranslate"><span class="pre">RandRotated</span></code> and <code class="docutils literal notranslate"><span class="pre">RandZoomd</span></code>). Furthermore, the crop that occurs means that the output data
samples might contain pixels for which there is data but that show padding values, because the data was thrown away by
<code class="docutils literal notranslate"><span class="pre">RandSpatialCrop</span></code>.</p>
<p>Each of these operations takes time and memory, but, as we can see in the example above, also creates resampling
artifacts and can even destroy data in the resulting data samples.</p>
</section>
<section id="lazy-execution">
<h3>Lazy execution<a class="headerlink" href="#lazy-execution" title="Link to this heading">#</a></h3>
<p>Lazy resampling works very differently. When you execute the same pipeline with <cite>lazy=True</cite>, the following happens:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Spacingd</span></code> is executed lazily. It puts a description of the operation that it wants to perform onto a list of
pending operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Orientationd</span></code> is executed lazily. It adds a description of its own operation to the pending operation list so
now there are 2 pending operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RandSpatialCropd</span></code> is executed lazily. It adds a description of its own operation to the pending
operation list so now there are 3 pending operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RandRotate90d</span></code> is executed lazily. It adds a description of its own operation to the pending operation
list so now there are 4 pending operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RandRotated</span></code> is executed lazily. It adds a description of its own operation to the pending operation
list so now there are 5 pending operations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RandZoomd</span></code> is executed lazily. It adds a description of its own operation to the pending operation
list so now there are 6 pending operations</p>
<ol class="arabic simple">
<li><p>[Spacingd, Orientationd, RandSpatialCropd, RandRotate90d, RandRotated, RandZoomd] are all on the pending
operations list but have yet to be carried out on the data</p></li>
</ol>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">RandGaussianNoised</span></code> is not a lazy transform. It is now time for the pending operations to be evaluated. Their
descriptions are mathematically composited together, to determine the operation that results from all of them being
carried out. This is then applied in a single resample operation. Once that is done, RandGaussianNoised operates on
the resulting data</p></li>
</ol>
<figure class="align-default" id="id3">
<img alt="_images/lazy_resampling_lazy_example_1.svg" src="_images/lazy_resampling_lazy_example_1.svg" />
<figcaption>
<p><span class="caption-text">Figure showing lazy pipeline execution. We show the state of the <cite>pending_operations</cite> and <cite>applied_operations</cite>
properties of the tensor as it is processed by the pipeline. Thick red borders indicate some kind of resampling
operation has taken place at that step. Lazy resampling performs far fewer of these operations.</span><a class="headerlink" href="#id3" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The single resampling operation has less noise induced by resampling, as it only occurs once in this pipeline rather
than three times in the traditional pipeline. More importantly, although the crop describes an operation to keep only a
subset of the data sample, the crop is not performed until after the spatial transforms are completed, which means that
all of the data sample that is within bounds is preserved and is part of the resulting output.</p>
</section>
<section id="composing-homogeneous-matrices">
<h3>Composing homogeneous matrices<a class="headerlink" href="#composing-homogeneous-matrices" title="Link to this heading">#</a></h3>
<img alt="_images/lazy_resampling_homogeneous_matrices.svg" src="_images/lazy_resampling_homogeneous_matrices.svg" />
<p>Although a full treatment of homogeneous matrices is outside the scope of this document, a brief overview of them is
useful to understand the mechanics of lazy resampling. Homogeneous matrices are used in computer graphics to describe
operations in cartesian space in a unified (homogeneous) fashion. Rotation, scaling, translation, and skewing are
amongst the operations that can be performed. Homogeneous matrices have the interesting property that they can be
composited together, thus describing the result of a sequence of operations. Note that ordering is important;
<cite>scale -&gt; rotate -&gt; translation</cite> gives a very different result to <cite>translation -&gt; rotate -&gt; scale</cite>.</p>
<p>The ability to composite homogeneous matrices together allows a sequence of operations to be carried out as a single
operation, which is the key mechanism by which lazy resampling functions.</p>
</section>
</section>
<section id="api-changes">
<h2>API changes<a class="headerlink" href="#api-changes" title="Link to this heading">#</a></h2>
<p>A number of new arguments have been added to existing properties, which we’ll go over in detail here. In particular,
we’ll focus on <code class="xref py py-class docutils literal notranslate"><span class="pre">Compose&lt;monai.transforms.compose.Compose</span></code>&gt; and
<a class="reference internal" href="transforms.html#monai.transforms.LazyTrait" title="monai.transforms.traits.LazyTrait"><code class="xref py py-class docutils literal notranslate"><span class="pre">LazyTrait</span></code></a>/ <a class="reference internal" href="transforms.html#monai.transforms.LazyTransform" title="monai.transforms.transform.LazyTransform"><code class="xref py py-class docutils literal notranslate"><span class="pre">LazyTransform</span></code></a>
and the way that they interact with each other.</p>
<section id="compose">
<h3>Compose<a class="headerlink" href="#compose" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="transforms.html#monai.transforms.Compose" title="monai.transforms.compose.Compose"><code class="xref py py-class docutils literal notranslate"><span class="pre">Compose</span></code></a> gains a number of new arguments that can be used to control
resampling behaviour. Each of them is covered in its own section:</p>
<section id="lazy">
<h4>lazy<a class="headerlink" href="#lazy" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">lazy</span></code> controls whether execution is carried out in a lazy manner or not. It has three values that it can take:</p>
<ul class="simple">
<li><p><cite>lazy=False</cite> forces the pipeline to be executed in the standard way with every transform applied immediately</p></li>
<li><p><cite>lazy=True</cite> forces the pipeline to be executed lazily. Every transform that implements
<a class="reference internal" href="transforms.html#monai.transforms.LazyTrait" title="monai.transforms.traits.LazyTrait"><code class="xref py py-class docutils literal notranslate"><span class="pre">LazyTrait</span></code></a> (or inherits
<a class="reference internal" href="transforms.html#monai.transforms.LazyTransform" title="monai.transforms.transform.LazyTransform"><code class="xref py py-class docutils literal notranslate"><span class="pre">LazyTransform</span></code></a>) will be executed lazily</p></li>
<li><p><cite>lazy=None</cite> means that the pipeline can execute lazily, but only on transforms that have their own <cite>lazy</cite> property
set to True.</p></li>
</ul>
</section>
<section id="overrides">
<h4>overrides<a class="headerlink" href="#overrides" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">overrides</span></code> allows the user to specify certain parameters that transforms can be overridden with when they are
executed lazily. This parameter is primarily provided to allow you to run a pipeline without having to modify fields
like <code class="docutils literal notranslate"><span class="pre">mode</span></code> and <code class="docutils literal notranslate"><span class="pre">padding_mode</span></code>.
When executing dictionary-based transforms, you provide a dictionary containing overrides for each key, as follows. You
can omit keys that don’t require overrides:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;bilinear&quot;</span><span class="p">},</span>
    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;padding_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;zeros&quot;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="log-stats">
<h4>log_stats<a class="headerlink" href="#log-stats" title="Link to this heading">#</a></h4>
<p>Logging of transform execution is provided if you wish to understand exactly how your pipelines execute. It can take a
<code class="docutils literal notranslate"><span class="pre">bool</span></code> or <code class="docutils literal notranslate"><span class="pre">str</span></code> value, and is False by default, which disables logging. Otherwise, you can enable it by passing it
the name of a logger that you wish to use (note, you don’t have to construct the logger beforehand).</p>
</section>
</section>
<section id="lazytrait-lazytransform">
<h3>LazyTrait / LazyTransform<a class="headerlink" href="#lazytrait-lazytransform" title="Link to this heading">#</a></h3>
<p>Many transforms now implement either <cite>LazyTrait&lt;monai.transforms.traits.LazyTrait&gt;</cite> or
<cite>LazyTransform&lt;monai.transforms.transform.Transform&gt;</cite>. Doing so marks the transform for lazy execution. Lazy
transforms have the following in common:</p>
<section id="init-has-a-lazy-argument">
<h4><code class="docutils literal notranslate"><span class="pre">__init__</span></code> has a <code class="docutils literal notranslate"><span class="pre">lazy</span></code> argument<a class="headerlink" href="#init-has-a-lazy-argument" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">lazy</span></code> is a <code class="docutils literal notranslate"><span class="pre">bool</span></code> value that can be passed to the initialiser when a lazy transform is instantiated. This
indicates to the transform that it should execute lazily or not lazily. Note that this value can be overridden by
passing <code class="docutils literal notranslate"><span class="pre">lazy</span></code> to <code class="docutils literal notranslate"><span class="pre">__init__</span></code>. <code class="docutils literal notranslate"><span class="pre">lazy</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code> by default</p>
</section>
<section id="call-has-a-lazy-argument">
<h4><code class="docutils literal notranslate"><span class="pre">__call__</span></code> has a <code class="docutils literal notranslate"><span class="pre">lazy</span></code> argument<a class="headerlink" href="#call-has-a-lazy-argument" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">lazy</span></code> is an optional <code class="docutils literal notranslate"><span class="pre">bool</span></code> value that can be passed at call time to override the behaviour defined during
initialisation. It has a default value of <code class="docutils literal notranslate"><span class="pre">None</span></code>. If it is not <code class="docutils literal notranslate"><span class="pre">None</span></code>, then this value is used instead of
<code class="docutils literal notranslate"><span class="pre">self.lazy</span></code>. This allows the calling <a class="reference internal" href="transforms.html#monai.transforms.Compose" title="monai.transforms.compose.Compose"><code class="xref py py-class docutils literal notranslate"><span class="pre">Compose</span></code></a> instance to override
default values rather than having to set it on every lazy transform (unless the user sets
<a class="reference internal" href="transforms.html#monai.transforms.Compose" title="monai.transforms.compose.Compose"><code class="xref py py-class docutils literal notranslate"><span class="pre">Compose.lazy</span></code></a> to <code class="docutils literal notranslate"><span class="pre">None</span></code>).</p>
</section>
<section id="lazy-property">
<h4>lazy property<a class="headerlink" href="#lazy-property" title="Link to this heading">#</a></h4>
<p>The lazy property allows you to get or set the lazy status of a lazy transform after constructing it.</p>
</section>
<section id="requires-current-data-property-get-only">
<h4>requires_current_data property (get only)<a class="headerlink" href="#requires-current-data-property-get-only" title="Link to this heading">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">requires_current_data</span></code> property indicates that a transform makes use of the data in one or more of the tensors
that it is passed during its execution. Such transforms require that the tensors must therefore be up to date, even if
the transform itself is executing lazily. This is required for transforms such as <code class="docutils literal notranslate"><span class="pre">CropForeground[d]</span></code>,
<code class="docutils literal notranslate"><span class="pre">RandCropByPosNegLabel[d]</span></code>, and <code class="docutils literal notranslate"><span class="pre">RandCropByLabelClasses[d]</span></code>. This property is implemented to return <code class="docutils literal notranslate"><span class="pre">False</span></code> on
<code class="docutils literal notranslate"><span class="pre">LazyTransform</span></code> and must be overridden to return <code class="docutils literal notranslate"><span class="pre">True</span></code> by transforms that check data values when executing.</p>
</section>
</section>
</section>
<section id="controlling-laziness">
<h2>Controlling laziness<a class="headerlink" href="#controlling-laziness" title="Link to this heading">#</a></h2>
<p>There are two ways that a user can provide more fine-grained control over laziness. One is to make use of lazy=None
when initialising or calling <code class="docutils literal notranslate"><span class="pre">Compose</span></code> instances. The other is to use the <code class="docutils literal notranslate"><span class="pre">ApplyPending[d]</span></code> transforms. These
techniques can be freely mixed and matched.</p>
<section id="using-lazy-none">
<h3>Using <code class="docutils literal notranslate"><span class="pre">lazy=None</span></code><a class="headerlink" href="#using-lazy-none" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Lazy=None</span></code> tells <code class="docutils literal notranslate"><span class="pre">Compose</span></code> to honor the lazy flags set on each lazy transform. These are set to False by default
so the user must set lazy=True on the transforms that they still wish to execute lazily.</p>
<section id="lazy-none-example">
<h4><code class="docutils literal notranslate"><span class="pre">lazy=None</span></code> example:<a class="headerlink" href="#lazy-none-example" title="Link to this heading">#</a></h4>
<figure class="align-default" id="id4">
<img alt="_images/lazy_resampling_none_example.svg" src="_images/lazy_resampling_none_example.svg" />
<figcaption>
<p><span class="caption-text">Figure shwoing the effect of using <code class="docutils literal notranslate"><span class="pre">lazy=False</span></code> when <code class="docutils literal notranslate"><span class="pre">Compose</span></code> is being executed with <code class="docutils literal notranslate"><span class="pre">lazy=None</span></code>. Note that
the additional resamples that occur due to <code class="docutils literal notranslate"><span class="pre">RandRotate90d</span></code> being executed in a non-lazy fashion.</span><a class="headerlink" href="#id4" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="using-applypending-d">
<h3>Using <code class="docutils literal notranslate"><span class="pre">ApplyPending[d]</span></code><a class="headerlink" href="#using-applypending-d" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ApplyPending[d]</span></code> causes all pending transforms to be executed before the following transform, regardless of whether
the following transform is a lazy transform, or is configured to execute lazily.</p>
<section id="applypending-example">
<h4><code class="docutils literal notranslate"><span class="pre">ApplyPending</span></code> Example:<a class="headerlink" href="#applypending-example" title="Link to this heading">#</a></h4>
<figure class="align-default" id="id5">
<img alt="_images/lazy_resampling_apply_pending_example.svg" src="_images/lazy_resampling_apply_pending_example.svg" />
<figcaption>
<p><span class="caption-text">Figure showing the use of <a class="reference internal" href="transforms.html#monai.transforms.ApplyPendingd" title="monai.transforms.lazy.dictionary.ApplyPendingd"><code class="xref py py-class docutils literal notranslate"><span class="pre">ApplyPendingd</span></code></a> to cause
resampling to occur in the midele of a chain of lazy transforms.</span><a class="headerlink" href="#id5" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="mb_properties.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">MONAI Bundle Properties</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-lazy-resampling-changes-preprocessing">How Lazy Resampling changes preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#traditional-execution">Traditional execution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lazy-execution">Lazy execution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#composing-homogeneous-matrices">Composing homogeneous matrices</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#api-changes">API changes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compose">Compose</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#lazy">lazy</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#overrides">overrides</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#log-stats">log_stats</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lazytrait-lazytransform">LazyTrait / LazyTransform</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#init-has-a-lazy-argument"><code class="docutils literal notranslate"><span class="pre">__init__</span></code> has a <code class="docutils literal notranslate"><span class="pre">lazy</span></code> argument</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#call-has-a-lazy-argument"><code class="docutils literal notranslate"><span class="pre">__call__</span></code> has a <code class="docutils literal notranslate"><span class="pre">lazy</span></code> argument</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#lazy-property">lazy property</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#requires-current-data-property-get-only">requires_current_data property (get only)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#controlling-laziness">Controlling laziness</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-lazy-none">Using <code class="docutils literal notranslate"><span class="pre">lazy=None</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#lazy-none-example"><code class="docutils literal notranslate"><span class="pre">lazy=None</span></code> example:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-applypending-d">Using <code class="docutils literal notranslate"><span class="pre">ApplyPending[d]</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#applypending-example"><code class="docutils literal notranslate"><span class="pre">ApplyPending</span></code> Example:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/lazy_resampling.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright MONAI Consortium.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>